<Page x:Class="WpfApplication1.Views.SquatPage" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Title="SquatPage" Background="White">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="360" />
        </Grid.ColumnDefinitions>

        <!-- LEFT: Camera + Skeleton overlay -->
        <Grid Grid.Column="0">
            <Viewbox Stretch="Uniform" StretchDirection="DownOnly">
                <Grid Width="1920" Height="1080">
                    <Image x:Name="CameraImage" Stretch="Fill"/>
                    <Canvas x:Name="SkeletonCanvas" Background="Transparent"/>

                    <!-- DEBUG HUD (bottom-left) -->
                    <Border x:Name="DebugHud"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Bottom"
                        Margin="12"
                        Background="#80000000"
                        CornerRadius="6">
                        <Border.Padding>
                            <Thickness>10</Thickness>
                        </Border.Padding>
                        <StackPanel>
                            <TextBlock x:Name="PhaseText"
                                   Text="Phase: standing"
                                   FontSize="14"
                                   Foreground="White"/>
                            <TextBlock x:Name="HipDropText"
                                   Text="Hip drop: 0 cm"
                                   FontSize="14"
                                   Foreground="White"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Viewbox>
        </Grid>

        <!-- RIGHT: Chat-style feedback panel -->
        <Border Grid.Column="1" Background="#FFF8F8F8" BorderBrush="#FFE0E0E0" BorderThickness="1,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header (fixed, always on top) -->
                <DockPanel Grid.Row="0" LastChildFill="False" Margin="12,12,12,8" Panel.ZIndex="10">
                    <StackPanel Orientation="Vertical" DockPanel.Dock="Left">
                        <TextBlock Text="Squat Coach"
                           FontSize="20"
                           FontWeight="Bold"
                           Foreground="#222"/>
                        <!-- Overwrite-only HUD headline (no chat bubble) -->
                        <TextBlock x:Name="CoachHeadline"
                           Text="Ready for squats!"
                           FontSize="14"
                           Foreground="#555"
                           Margin="0,4,0,0"
                           TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- Count badge -->
                    <Border DockPanel.Dock="Right"
                    CornerRadius="10"
                    Background="#E7F6EA"
                    BorderBrush="#B7E0BD"
                    BorderThickness="1"
                    Margin="12,0,0,0">
                        <!-- Border supports Padding -->
                        <Border.Padding>
                            <Thickness>10,8,10,8</Thickness>
                        </Border.Padding>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="Squats"
                               Foreground="#2B7A0B"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Margin="0,0,8,0"/>
                            <TextBlock x:Name="SquatCountText"
                               Text="0"
                               FontSize="26"
                               FontWeight="Bold"
                               Foreground="#1E5C07"
                               VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </DockPanel>

                <!-- Messages list (with a top spacer equal to header height) -->
                <ScrollViewer Grid.Row="1"
                      x:Name="ChatScroll"
                      VerticalScrollBarVisibility="Auto"
                      Margin="0,0,0,8">
                    <ItemsControl x:Name="ChatItems">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <!-- Fixed spacer item prevents overlap with header -->
                        <ItemsControl.Template>
                            <ControlTemplate TargetType="ItemsControl">
                                <ScrollViewer CanContentScroll="False" VerticalScrollBarVisibility="Disabled">
                                    <StackPanel>
                                        <!-- Adjust Height if you tweak header/badge size -->
                                        <Border Height="56" Background="Transparent"/>
                                        <ItemsPresenter/>
                                    </StackPanel>
                                </ScrollViewer>
                            </ControlTemplate>
                        </ItemsControl.Template>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border CornerRadius="8"
                                Margin="12,8,12,0"
                                Background="{Binding BubbleColor}">
                                    <!-- Inner padding -->
                                    <Border.Padding>
                                        <Thickness>10</Thickness>
                                    </Border.Padding>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Timestamp}"
                                           FontSize="11"
                                           Foreground="#888"/>
                                        <TextBlock Text="{Binding Text}"
                                           FontSize="14"
                                           Foreground="#111"
                                           TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Input area -->
                <Grid Grid.Row="2" Margin="12,0,12,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="ChatInput"
                     MinHeight="36"
                     FontSize="14"
                     Margin="0,0,8,0"
                     VerticalContentAlignment="Center"
                     Padding="8"
                     Tag="Type a note (optional)"/>
                    <Button Grid.Column="1"
                    x:Name="SendBtn"
                    Content="Send"
                    MinWidth="70"
                    Height="36"
                    Click="SendBtn_Click"/>
                </Grid>
            </Grid>
        </Border>

        <!-- Full-page pause overlay (shown when tracking is unreliable) -->
        <Grid x:Name="PausePanel"
      Grid.ColumnSpan="2"
      Background="#80000000"
      Visibility="Collapsed">
            <Border Background="White"
            Width="380"
            HorizontalAlignment="Center"
            VerticalAlignment="Center">
                <Border.Padding>
                    <Thickness>20</Thickness>
                </Border.Padding>
                <StackPanel>
                    <TextBlock Text="Tracking Paused"
                       FontSize="18"
                       FontWeight="Bold"
                       Foreground="#111"
                       Margin="0,0,0,8"
                       TextAlignment="Center"/>
                    <TextBlock x:Name="PauseText"
                       Text="Paused due to tracking issues. Tap Continue to resume."
                       FontSize="14"
                       Foreground="#333"
                       TextWrapping="Wrap"
                       Margin="0,0,0,12"
                       TextAlignment="Center"/>
                    <Button x:Name="ContinueBtn"
                    Content="Continue"
                    Width="140"
                    Height="36"
                    HorizontalAlignment="Center"
                    Click="ContinueBtn_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>